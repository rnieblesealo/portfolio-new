import { IoPeopleSharp } from "react-icons/io5";
import { RiShareBoxLine } from "react-icons/ri";
import projects from "../../data/projects"
import { useState } from "react";
import { cva } from "class-variance-authority"
import BigHeading from "../comps/BigHeading.tsx"

const projectCard = cva(
  // default classes
  "flex flex-col items-center w-full h-full max-w-[300px] rounded-lg cursor-pointer",
  {
    // variant categories
    variants: {
      variant: {
        normal: "bg-black text-white",
        codepath: "bg-gray-200 text-gray-700 font-bold"
      }
    },
    // sets default variants
    defaultVariants: {
      variant: "normal"
    }
  }
)

const projectHeading = cva(
  "rounded-t-lg text-[1.25rem] p-2 box-border break-all text-center flex flex-wrap items-center justify-center gap-2 font-extrabold text-xl",
  {
    // variant categories
    variants: {
      variant: {
        normal: "",
        codepath: "text-white bg-gradient-to-r from-[#18626c] via-[#19305d] to-[#31235b]"
      }
    },
    // sets default variants
    defaultVariants: {
      variant: "normal"
    }
  }
)

const projectTags = cva(
  "cursor-pointer text-[0.75rem] font-bold transition-bg duration-[0.1s] bg-gray-700 hover:bg-gray-900 rounded-2xl text-white p-1 pl-3 pr-3 text-center",
  {
    // variant categories
    variants: {
      variant: {
        normal: "bg-gray-800",
        codepath: "bg-gray-700"
      }
    },
    // sets default variants
    defaultVariants: {
      variant: "normal"
    }
  }
)

type ProjectProps = {
  name: string,
  desc: string,
  langs: string[],
  url?: string,
  imgSrc?: string,
  color?: string,
  teamSize?: number,
  tags?: string[],
  variant: "normal" | "codepath"
}

// we don't instantiate in the .map because we need to use state for hover effect
function Project({ name, desc, url, imgSrc, color, langs, teamSize, tags, variant }: ProjectProps) {
  const [isHovered, setIsHovered] = useState(false)

  const langElements = langs.map((lang) => {
    return (
      <li key={lang} className="text-[2.5rem]">
        <i className={`devicon-${lang}-plain`} />
      </li>
    )
  })

  const teamSizeElement = teamSize && (
    <p
      className="flex items-center justify-center gap-2 text-center font-bold">
      <IoPeopleSharp />Team Size: {`${teamSize ?? 1}`}
    </p>
  )

  const tagElements = tags?.map((tag) => {
    return (
      <li
        key={tag}
        className={projectTags({ variant: variant })}>
        {tag}
      </li >
    )
  })

  const tagCollection = (
    <ul className="flex flex-row flex-wrap items-center justify-center gap-1 mt-2 mb-2">
      {tagElements}
    </ul>
  )

  const hoverColor = (variant === "codepath" ? "#31235b" : color)

  return (
    <li
      className="bg-black p-3 rounded-2xl"
      style={{
        transition: "box-shadow 0.25s ease, transform 0.25s ease",
        ...(isHovered ? { boxShadow: `0px 0px 50px ${hoverColor}`, transform: "scale(105%)" } : {})
      }}>
      <div
        className={projectCard({ variant: variant })}
        onMouseEnter={() => { setIsHovered(true) }}
        onMouseLeave={() => { setIsHovered(false) }}>
        <a href={url} target="_blank">
          <h3
            className={projectHeading({ variant: variant })}
            style={{
              // NOTE: must use ... to do boolean style checking
              // ... only spreads truthy keys 
              // if we weren't to include it, we might get something that turns into a "false"
              // that's not a KV pair so the object breaks!
              ...(variant === "normal" ? { backgroundColor: color } : {})
            }}>
            {name}
            <span className="text-[1rem]">
              <RiShareBoxLine />
            </span>
          </h3>
          <img
            src={imgSrc}
            alt="Project demo"
            className="w-full aspect-square object-cover mb-4"
          />
          <div className="flex flex-col p-5">
            <p className="text-center">{desc}</p>
            <ul className="w-full flex flex-row flex-wrap items-center justify-center gap-2 my-4">
              {langElements}
            </ul>
            {teamSizeElement}
            {tagCollection}
          </div>
        </a>
      </div>
    </li >
  )
}

export default function Projects() {
  const projectElements = projects.map((proj) => {
    return (
      <Project
        key={proj.id}
        url={proj.url}
        name={proj.name}
        desc={proj.desc}
        imgSrc={proj.imgSrc}
        color={proj.color}
        langs={proj.langs}
        teamSize={proj.teamSize}
        tags={proj.tags}
        variant="codepath"
      />
    )
  })

  return (
    <div>
      <BigHeading id="proj" text="My Projects!" />
      <ul className="max-w-[100%] grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 p-2" >
        {projectElements}
      </ul >
    </div>
  )
}
